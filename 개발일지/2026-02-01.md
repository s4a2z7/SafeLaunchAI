# 개발 일지: 스토어 정책 데이터 수집 및 적재
- 날짜: 2026-02-01
- 태그: #스토어정책 #VectorDB #Apple #GooglePlay #데이터수집

---

## 오늘의 목표
- [x] Apple App Store Review Guidelines 수집
- [x] Google Play Developer Program Policy 수집
- [x] store_policies 컬렉션 적재 (0건 -> 36건)
- [x] 검색 테스트 및 검증

## 작업 내용

### 진행 사항
- Apple App Store Review Guidelines 전문 수집 (20개 섹션)
  - 1. Safety (5): 부적절한 콘텐츠, UGC, 키즈, 신체적 위해, 개발자 정보
  - 2. Performance (3): 앱 완성도, 메타데이터, 하드웨어/소프트웨어 요구사항
  - 3. Business (4): 인앱 구매, 구독, 기타 결제, 비즈니스 모델
  - 4. Design (3): 카피캣, 최소 기능, 스팸/미니앱/로그인
  - 5. Legal (5): 데이터 수집, 데이터 공유, 건강/어린이/위치, IP/도박, VPN/MDM

- Google Play Developer Program Policy 수집 (16개 섹션)
  - Restricted Content (4): 아동 안전, 부적절한 콘텐츠, 금융/도박/불법, UGC/블록체인
  - Privacy/Deception/Device Abuse (3): 사용자 데이터, 기만적 행위, 기기/네트워크 악용
  - Intellectual Property (1): 저작권/상표/위조
  - Monetization and Ads (2): 결제/구독, 광고 정책
  - Store Listing (1), Spam (1), Malware (1), SDK (1), Families (1), Enforcement (1)

- `core/legal_rag.py`에 `ingest_store_policies()` 함수 추가
- `core/store_policy_data.py` 데이터 모듈 신규 작성
- `ingest_store_policies.py` 적재 스크립트 작성

### 사용한 도구
- Claude Code (웹 스크래핑, 코드 작성)
- WebFetch (Apple 가이드라인 전문 수집)
- WebSearch (Google Play 정책 구조 파악)

## 삽질 기록 (Troubleshooting)

### 문제 1: Google Play 정책 페이지 수집 불가
- Google Play 정책 페이지가 JavaScript 렌더링 방식이라 WebFetch로 본문 추출 불가
- 해결: WebSearch로 정책 구조를 파악하고, 기사/공식 요약 + 학습 데이터를 종합하여 정책 텍스트 구성

### 문제 2: source_id 중복으로 청크 덮어쓰기 (36건 -> 15건)
- 원인: source_id가 `store_section` 조합으로만 생성되어, 같은 section 내 여러 subsection이 동일 ID를 받음
- 해결: source_id 생성 시 `subsection`까지 포함하도록 수정
- `f"{store}_{section}_{subsection}"` 패턴으로 고유성 확보

### 문제 3: Windows 콘솔 인코딩 에러 (cp949)
- 원인: em dash 문자와 한글이 Windows cp949 인코딩과 충돌
- 해결: `PYTHONIOENCODING=utf-8 python -X utf8` 옵션으로 실행

## 새로 알게 된 점 (TIL)
- Apple 가이드라인은 섹션별로 잘 구조화되어 있어 자동 수집에 적합
- Google Play 정책은 JS 렌더링 + 동적 로딩이라 정적 수집이 어려움
- chunk_law_text()의 source_id 기반 해시 생성에서 고유성 보장이 중요

## 넥스트 스텝
- [ ] score_threshold 튜닝 (현재 기본 0.7, 스토어 정책 검색 시 0.4~0.5 수준)
- [ ] search_legal_context()에서 store_policies 포함 통합 검색 검증
- [ ] core/analyzer.py 구현 시 P(Policy) 요소 연동

---

## 회고
드디어 store_policies 컬렉션이 0건에서 36건으로 채워졌다.
RS 산출 공식의 P(Policy) 요소를 계산할 수 있는 기반이 마련됨.
Google Play 정책은 향후 Selenium 등을 활용한 동적 수집으로 보강 필요.
