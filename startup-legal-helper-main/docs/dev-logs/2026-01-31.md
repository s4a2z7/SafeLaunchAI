# 📅 개발 일지: 문서화 및 명세서 작성 + 벡터 DB 구현
- 날짜: 2026-01-31
- 태그: #SafeLaunchAI #문서화 #개발명세서 #API명세서 #VectorDB #LegalRAG

---

## 🎯 오늘의 목표
- [x] 개발일지·개발명세서·API 명세서 문서 체계 구축
- [x] 기획안 기반 개발명세서 초안 작성
- [x] 외부 API 및 내부 모듈 API 명세 정리
- [x] core/legal_rag.py 벡터 DB 모듈 구현
- [x] 벡터 DB 개발 가이드 스킬 작성

## 🛠 작업 내용

### 오전: 문서 체계 구축
- 개발일지 목록에 2026-01-31 항목 추가
- 개발명세서.md 신규 작성 (기능/기술/모듈/데이터/UI 명세)
- API명세서.md 신규 작성 (국가법령정보 API, 내부 인터페이스, M-2 JSON 스키마)
- docs/dev-logs/ 폴더에 당일 일지 템플릿 적용

### 오후: 벡터 DB (legal_rag.py) 구현
- **skills/develop-vector-db/SKILL.md** 신규 작성 — 벡터 DB 개발 가이드 스킬
- **core/legal_rag.py** 신규 구현 — 법률 RAG 벡터 검색 모듈
  - `VectorStore` 클래스: TF-IDF + cosine_similarity 기반 벡터 스토어
  - `chunk_law_text()`: 조문 경계(제N조) 기반 Context-aware Chunking (800자/150자 오버랩)
  - `ingest_laws()`: 법령 검색 → 상세 조회 → 청킹 → 저장 파이프라인
  - `ingest_precedents()`: 판례 검색 → 상세 조회 → 청킹 → 저장 파이프라인
  - `search_legal_context()`: API명세서 3.2 인터페이스 준수 유사도 검색
  - `sync_legal_data()`: F-6 데이터 동기화 기능
- **database/** 디렉토리 생성 — JSON 기반 영속 저장소

### 테스트 결과
- 법령 적재: 저작권법·시행령·시행규칙 → **152청크** 저장 성공
- 판례 적재: 저작권 침해 관련 **3건** 저장 성공
- 검색: "앱 저작권 침해 기준" → 제123조(침해 정지 청구) 반환 (score 0.589)
- 영속 저장: `database/laws.json` (269KB), `database/precedents.json` (1.7KB) 확인

- **사용한 도구:**
  - Cursor, Claude Code, scikit-learn, numpy

## 🚧 삽질 기록 (Troubleshooting)
- **ChromaDB Python 3.14 미지원**: chromadb 1.4.1이 pydantic v1 호환 이슈로 Python 3.14에서 동작하지 않음. `onnxruntime`도 Python 3.14 빌드 미제공.
  - **해결**: scikit-learn `TfidfVectorizer` + `cosine_similarity` 기반으로 대체 구현. API 인터페이스(`search_legal_context` 시그니처)는 동일 유지하여 향후 ChromaDB 전환 시 내부만 교체 가능하도록 설계.
- **판례 상세 API HTML 응답**: `get_precedent_detail()` 호출 시 구조화된 XML이 아닌 HTML 페이지가 반환됨.
  - **해결**: `_extract_text_from_html_dict()` 함수 추가하여 HTML dict 구조에서 텍스트 추출 처리.
- **Windows cp949 인코딩 오류**: `print()`에서 em dash(—) 문자 출력 시 `UnicodeEncodeError` 발생.
  - **해결**: `PYTHONIOENCODING=utf-8` 환경변수로 실행.

## 💡 새로 알게 된 점 (TIL)
- 국가법령정보 Open API: law.go.kr DRF 엔드포인트, OC(이메일 ID)·target·type 등 필수 파라미터 구조
- TF-IDF `char_wb` analyzer + ngram(1,3)이 한글 법률 텍스트 유사도 검색에 효과적
- ChromaDB/onnxruntime 등 주요 ML 패키지의 Python 3.14 지원이 아직 불완전 — 프로젝트 초기에 Python 버전 호환성 검증 필요

## 📌 넥스트 스텝
- [ ] core/benchmarker.py 타겟 URL 스크래핑 모듈 구현
- [ ] core/analyzer.py RS 점수 계산 및 LLM 연동 구현
- [ ] core/strategist.py 우회 전략·리포트 생성 구현
- [ ] app.py Streamlit 대시보드 구현 시작
- [ ] 판례 API 상세 조회 정확도 개선 (XML 응답 확보 방안 검토)

---

## 💭 회고
프로젝트 초기 단계에서 명세를 먼저 정리해 두면 이후 개발·협업 시 기준이 명확해질 것 같다.
벡터 DB 구현 과정에서 Python 3.14 호환 이슈를 만났지만, 인터페이스를 동일하게 유지한 대체 구현으로 해결했다. 외부 라이브러리 의존성 문제를 사전에 확인하는 것의 중요성을 체감했다.
